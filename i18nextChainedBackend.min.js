!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).i18nextChainedBackend=t()}(this,(function(){"use strict";function n(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function e(n){var e=function(n,e){if("object"!==t(n)||null===n)return n;var i=n[Symbol.toPrimitive];if(void 0!==i){var o=i.call(n,e||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"===t(e)?e:String(e)}function i(n,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,e(o.key),o)}}var o=[],r=o.forEach,a=o.slice;function c(n){return r.call(a.call(arguments,1),(function(t){if(t)for(var e in t)void 0===n[e]&&(n[e]=t[e])})),n}function u(n){return n?"function"==typeof n?new n:n:null}var f=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this.backends=[],this.type="backend",this.init(e,i)}var e,o,r;return e=t,(o=[{key:"init",value:function(n){var t=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.services=n,this.options=c(e,this.options||{},{handleEmptyResourcesAsFailed:!0}),this.options.backends&&this.options.backends.forEach((function(e,o){t.backends[o]=t.backends[o]||u(e),t.backends[o].init(n,t.options.backendOptions&&t.options.backendOptions[o]||{},i)}))}},{key:"read",value:function(n,t,e){var i=this,o=this.backends.length,r=function e(o,r){if(!(o<0)){var a=i.backends[o];a.save?(a.save(n,t,r),e(o-1,r)):e(o-1,r)}};!function a(c){if(c>=o)return e(new Error("non of the backend loaded data;",!0));var u=c===o-1,f=i.options.handleEmptyResourcesAsFailed&&!u?0:-1,l=i.backends[c];if(l.read){var s=function(n,t){!n&&t&&Object.keys(t).length>f?(e(null,t,c),r(c-1,t)):a(c+1)},d=l.read.bind(l);if(2===d.length){try{var h=d(n,t);h&&"function"==typeof h.then?h.then((function(n){return s(null,n)})).catch(s):s(null,h)}catch(n){s(n)}return}d(n,t,s)}else a(c+1)}(0)}},{key:"create",value:function(n,t,e,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.backends.forEach((function(a){if(a.create){var c=a.create.bind(a);if(c.length<6)try{var u;(u=5===c.length?c(n,t,e,i,r):c(n,t,e,i))&&"function"==typeof u.then?u.then((function(n){return o(null,n)})).catch(o):o(null,u)}catch(n){o(n)}else c(n,t,e,i,o,r)}}))}}])&&i(e.prototype,o),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();return f.type="backend",f}));
