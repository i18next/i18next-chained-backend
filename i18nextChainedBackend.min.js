!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).i18nextChainedBackend=e()}(this,(function(){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function e(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}var t=[],i=t.forEach,o=t.slice;function a(n){return i.call(o.call(arguments,1),(function(e){if(e)for(var t in e)void 0===n[t]&&(n[t]=e[t])})),n}function c(n){return n?"function"==typeof n?new n:n:null}var r=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this.backends=[],this.type="backend",this.init(e,i)}var i,o,r;return i=t,(o=[{key:"init",value:function(n){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;this.services=n,this.options=a(t,this.options||{},{handleEmptyResourcesAsFailed:!0}),this.options.backends&&this.options.backends.forEach((function(t,o){e.backends[o]=e.backends[o]||c(t),e.backends[o].init(n,e.options.backendOptions&&e.options.backendOptions[o]||{},i)}))}},{key:"read",value:function(n,e,t){var i=this,o=this.backends.length,a=function t(o,a){if(!(o<0)){var c=i.backends[o];c.save?(c.save(n,e,a),t(o-1,a)):t(o-1,a)}};!function c(r){if(r>=o)return t(new Error("non of the backend loaded data;",!0));var s=r===o-1,f=i.options.handleEmptyResourcesAsFailed&&!s?0:-1,l=i.backends[r];if(l.read){var u=function(n,e){!n&&e&&Object.keys(e).length>f?(t(null,e,r),a(r-1,e)):c(r+1)},d=l.read.bind(l);if(2===d.length){try{var h=d(n,e);h&&"function"==typeof h.then?h.then((function(n){return u(null,n)})).catch(u):u(null,h)}catch(n){u(n)}return}d(n,e,u)}else c(r+1)}(0)}},{key:"create",value:function(n,e,t,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.backends.forEach((function(c){if(c.create){var r=c.create.bind(c);if(r.length<6)try{var s;(s=5===r.length?r(n,e,t,i,a):r(n,e,t,i))&&"function"==typeof s.then?s.then((function(n){return o(null,n)})).catch(o):o(null,s)}catch(n){o(n)}else r(n,e,t,i,o,a)}}))}}])&&e(i.prototype,o),r&&e(i,r),Object.defineProperty(i,"prototype",{writable:!1}),t}();return r.type="backend",r}));
